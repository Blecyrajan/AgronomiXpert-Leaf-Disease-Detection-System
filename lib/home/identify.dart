import 'dart:convert';

import 'package:cropsight/home/disease.dart';
import 'package:cropsight/home/pref.dart';
import 'package:flutter/material.dart';
import 'package:cropsight/constants.dart';
import 'package:image_picker/image_picker.dart';
import 'package:http/http.dart' as http;

List<String> class_names = [
  '''Late Blight''',
  '''Early Blight''',
  '''Bacterial Spot''',
  '''Spider Mites (Two-Spotted Spider Mite)''',
  '''Septoria Leaf Spot''',
  '''Leaf Mold''',
  '''Tomato healthy''',
  '''Tomato Mosaic Virus''',
  '''Tomato Yellow Leaf Curl Virus''',
  '''Target Spot'''
];

Map<String, String> malayalamTranslations = {
  '''Late Blight''': '''ശെന്ന രോഗം''',
  '''Early Blight''': '''മുന്‍ രോഗം''',
  '''Bacterial Spot''': '''ബാക്ടീരിയൽ പോട്ട്''',
  '''Spider Mites (Two-Spotted Spider Mite)''': '''ചിലനി പടക്കം''',
  '''Septoria Leaf Spot''': '''സെപ്റ്റോറിയ ലീഫ് സ്പോട്ട്''',
  '''Leaf Mold''': '''മരത്തിന് മോൾഡ്''',
  '''Tomato healthy''': '''തക്കാളി ആരോഗ്യം''',
  '''Tomato Mosaic Virus''': '''തക്കാളി മൊസൈക് വൈറസ്''',
  '''Tomato Yellow Leaf Curl Virus''': '''തക്കാളി മഞ്ഞ ലീഫ് കർള് വൈറസ്''',
  '''Target Spot''': '''ടാർഗെറ്റ് സ്പോട്ട്'''
};

Map<String, String> diseaseDescriptions = {
  '''Late Blight''':
      '''1. രോഗപ്രതിരോധശേഷിയുള്ള ഇനങ്ങൾ തിരഞ്ഞെടുക്കുക: എർലി ബ്ലൈറ്റ് രോഗത്തോട് പ്രതിരോധശേഷിയുള്ള തക്കാളി ഇനങ്ങൾ നടുക. ഇത് രോഗബാധ കുറയ്ക്കാൻ സഹായിക്കും.

2. രോഗബാധിതമായ ഇലകളും കായ്കളും നീക്കം ചെയ്യുക: എർലി ബ്ലൈറ്റ് ലക്ഷണങ്ങളുള്ള ഇലകളും കായ്കളും ശ്രദ്ധാപൂർവ്വം നീക്കം ചെയ്ത് നശിപ്പിക്കുക. ഇത് രോഗവ്യാപനം തടയുന്നതിന് സഹായകരമാകും.

3. മള്ച്ചിംഗ് നടപ്പിലാക്കുക: തക്കാളിച്ചെടികളുടെ ചുറ്റും മള്ച്ചിംഗ് നല്കുക. ഇത് മണ്ണിൽ നിന്നുള്ള ഫംഗസ് സ്പോർ ചാടിക്കയറുന്നത് തടയുന്നതിനും മണ്ണിലെ ആർദ്രത നിലനിർത്താനും സഹായിക്കും.

4. ജലസംരക്ഷണം നടപ്പിലാക്കുക: മുകളിൽനിന്നുള്ള ജലസേചനം ഒഴിവാക്കി ചെടികളുടെ അടിവശത്ത് ജലസേചനം നടത്തുക. ഇത് ഇലകളിലെ അമിതാർദ്രത ഒഴിവാക്കും.

5. കൃത്യമായ അകലം പാലിക്കുക: തക്കാളിച്ചെടികൾക്കിടയിൽ കൃത്യമായ അകലം പാലിക്കുന്നത് കാറ്റടിക്കുന്നതിലൂടെ രോഗവ്യാപനം തടയും.

6. ഫംഗസൈഡുകൾ പ്രയോഗിക്കുക: കെലോറോഥലോണിൽ, മാങ്കോസെബ്, പ്രോപിനെബ് തുടങ്ങിയ ഫംഗസൈഡുകളുടെ ഉപയോഗം രോഗബാധ കുറയ്ക്കാൻ സഹായിക്കും. നിർദ്ദേശങ്ങൾ കൃത്യമായി പാലിക്കണം.

7. വിളചക്രഘട്ടനം പാലിക്കുക: എർലി ബ്ലൈറ്റ് രോഗബാധയുണ്ടായ സ്ഥലത്ത് കുറഞ്ഞത് രണ്ടുവർഷം തക്കാളി നടുന്നത് ഒഴിവാക്കുക. ഇത് രോഗചക്രം തകർക്കാൻ സഹായിക്കും.

8. ശുചിത്വം പാലിക്കുക: രോഗബാധിതമായ ചെടികളുമായി ബന്ധപ്പെട്ട ഉപകരണങ്ങൾ, തണ്ടുകൾ തുടങ്ങിയവ വൃത്തിയാക്കുക. തോട്ടത്തിന്റെ ശുചിത്വം പാലിക്കുക.''',
  '''Early Blight''':
      '''1. വിളചക്രഘട്ടനം പാലിക്കുക: കുറഞ്ഞത് 3 വർഷത്തേക്ക് അതേ സ്ഥലത്ത് തക്കാളി നടുന്നത് ഒഴിവാക്കുക. സോലാനേഷ്യൻ കുടുംബത്തിൽപ്പെടാത്ത വിളകളുമായി ചക്രഘട്ടനം പാലിക്കുക.

2. പ്രതിരോധശേഷിയുള്ള ഇനങ്ങൾ തിരഞ്ഞെടുക്കുക: അവാർ ബ്ലൈറ്റ് രോഗത്തോട് പ്രതിരോധശേഷിയോ ടോളറൻസോ ഉള്ള തക്കാളി ഇനങ്ങൾ നടുക.

3. രോഗബാധിതമായ ഭാഗങ്ങൾ നീക്കം ചെയ്യുക: രോഗബാധിതമായ ഇലകൾ, തണ്ടുകൾ, കായ്കൾ എന്നിവ നിരന്തരം നീക്കം ചെയ്ത് നശിപ്പിക്കുക.

4. വായുസഞ്ചാരം മെച്ചപ്പെടുത്തുക: ചെടികളുടെ താഴെവശങ്ങൾ വൃത്തിയാക്കുകയും കമ്പുകൾ വച്ച് പിന്തുണ നൽകുകയും ചെയ്യുക. ഇത് വായുസഞ്ചാരവും ആർദ്രതാനിയന്ത്രണവും സാധ്യമാക്കും.

5. മണ്ണിന് മള്ച്ചിംഗ് നൽകുക: ചെടികളുടെ ചുറ്റും കനത്ത സാംപ്ലുമള്ച്ചിംഗ് നൽകുക. ഇത് മണ്ണിലെ സ്പോറുകൾ ജലത്തിന്റെ ചാട്ടംമൂലം ഇലകളിലേക്ക് എത്തുന്നത് തടയും.

6. മുകളിലൂടെയുള്ള ജലസേചനം ഒഴിവാക്കുക: ചെടികളുടെ അടിവശത്ത് ജലസേചനം നൽകുക, ഡ്രിപ്പ് ഇറിഗേഷൻ സംവിധാനം ഉപയോഗിക്കുന്നത് ഉത്തമം. ഇത് ജലത്തിന്റെ ചാട്ടംമൂലമുള്ള രോഗവ്യാപനം തടയും.

7. ഫംഗസൈഡുകൾ പ്രയോഗിക്കുക: ക്ലോറോഥലോണിൽ, മാൻകോസെബ്, കോപ്പർ ലായനികൾ തുടങ്ങിയ ശുപാർശ ചെയ്യപ്പെട്ട ഫംഗസൈഡുകൾ പ്രതിരോധാത്മകമായി ഉപയോഗിക്കുക.

8 . പോഷകമൂല് യങ്ങൾ സമതുലിതമാക്കുക: സമതുലിതമായ വളപ്രയോഗം ഉറപ്പുവരുത്തുക, പോഷകക്കുറവ് ചെടികളെ രോഗബാധയ്ക്കു വഴിവയ്ക്കും.

9. വിളവെടുപ്പിനുശേഷം ചെടിയവശിഷ്ടങ്ങൾ നീക്കം ചെയ്യുക: വിളവെടുപ്പിനുശേഷം ചെടിയവശിഷ്ടങ്ങൾ മുഴുവനായി നീക്കം ചെയ്ത് നശിപ്പിക്കുക. ഇത് അടുത്തവർഷത്തെ രോഗബാധ തടയും.''',
  '''Bacterial Spot''':
      '''തക്കാളിച്ചെടികളിലെ ബാക്ടീരിയൽ സ്പോട്ട് രോഗത്തിന്റെ ചികിത്സാ നിർദ്ദേശങ്ങൾ താഴെ കൊടുത്തിരിക്കുന്നു:

1. ബാധിതമായ ഇലകളും സസ്യാവശിഷ്ടങ്ങളും നീക്കം ചെയ്യുക: രോഗബാധിതമായ ഇലകളും സസ്യാവശിഷ്ടങ്ങളും ശ്രദ്ധാപൂർവ്വം നീക്കം ചെയ്ത് നശിപ്പിക്കുക. ഇത് രോഗവ്യാപനം കുറയ്ക്കാൻ സഹായിക്കും.

2. പ്രതിരോധശേഷിയുള്ള ഇനങ്ങൾ തിരഞ്ഞെടുക്കുക: ബാക്ടീരിയൽ സ്പോട്ട് രോഗത്തിനെതിരെ പ്രതിരോധശേഷിയുള്ള തക്കാളി ഇനങ്ങൾ നടുന്നത് പരിഗണിക്കുക.

3. വളർച്ചാസൗകര്യങ്ങൾ മെച്ചപ്പെടുത്തുക: അമിതമായ ആർദ്രതയും താപനിലയും ഒഴിവാക്കുക. ഇത് രോഗാണുക്കളുടെ വളർച്ചയെ പ്രതികൂലമായി ബാധിക്കും.

4. കീടനാശിനി പ്രയോഗം: കാപ്പർ അധിഷ്ഠിത കീടനാശിനികൾ ഉപയോഗിക്കുന്നത് രോഗബാധ കുറയ്ക്കാൻ സഹായിക്കും. എന്നാൽ നിർദ്ദേശങ്ങൾ കൃത്യമായി പിന്തുടരുക.

5. വിളചക്രഘട്ടനം: ബാക്ടീരിയൽ സ്പോട്ട് രോഗം കാരണം കഴിഞ്ഞ വർഷം ബാധിച്ച സ്ഥലത്ത് തക്കാളി നടുന്നത് ഒഴിവാക്കുക. വിളകൾ ചക്രഘട്ടനം ചെയ്യുന്നത് രോഗചക്രം തകർക്കാൻ സഹായിക്കും.

6. ശുചിത്വം പാലിക്കുക: തോട്ടത്തിലെ ഉപകരണങ്ങളും ഉപകരണങ്ങളും വൃത്തിയായി സൂക്ഷിക്കുക. ഇത് രോഗവ്യാപനം തടയാൻ സഹായകരമാകും.

7. ജലസംരക്ഷണം: മുകളിൽനിന്നുള്ള ജലസേചനം ഒഴിവാക്കി അടിവശത്തുള്ള ജലസേചനം നടപ്പിലാക്കുക. ഇത് ഇലകളിലെ അമിതാർദ്രത ലഘൂകരിക്കും.

ബാക്ടീരിയൽ സ്പോട്ടുകാരണമുള്ള പ്രശ്നങ്ങൾ കൈകാര്യം ചെയ്യുന്നതിന് ഈ സമഗ്രമായ മുൻകരുതലുകൾ സഹായകരമാകും.''',
  '''Spider Mites (Two-Spotted Spider Mite)''': '''
1. നിരീക്ഷിക്കുക: സ്പെെഡർ മൈറ്റുകളുടെയും അവയുടെ വലകളുടെയും സാന്നിധ്യം കണ്ടെത്താൻ ചെടികൾ, പ്രത്യേകിച്ച് ഇലകളുടെ കീഴ്ഭാഗങ്ങൾ, നിരന്തരം നിരീക്ഷിക്കുക.

2. ശക്തമായ ജലപ്രവാഹം ഉപയോഗിക്കുക: ശക്തമായ ജലപ്രവാഹം സ്പെെഡർ മൈറ്റുകളെ ചെടികളിൽ നിന്ന് അകറ്റാൻ സഹായിക്കും.

3. ഹന്തക മൈറ്റുകളെ പ്രവർത്തിപ്പിക്കുക: Phytoseiulus persimilis അല്ലെങ്കിൽ Neoseiulus californicus പോലുള്ള ഹന്തക മൈറ്റുകളെ പ്രവർത്തിപ്പിക്കുക, അവ സ്പെെഡർ മൈറ്റുകൾക്കെതിരെ ഫലപ്രദമായ ജൈവനിയന്ത്രണ ഏജന്റുകളാണ്.

4. ഇൻസെക്‌ടിസൈഡൽ സോപ്പ് അല്ലെങ്കിൽ ഹോർട്ടിക്കൾച്ചറൽ ഓയിൽ പ്രയോഗിക്കുക: സ്പെെഡർ മൈറ്റുകളെ നിർജ്ജീവമാക്കുന്നതിനും ഗുണകരമായ കീടങ്ങളെ ബാധിക്കാതിരിക്കുന്നതിനും ഇൻസെക്‌ടിസൈഡൽ സോപ്പ് അല്ലെങ്കിൽ ഹോർട്ടിക്കൾച്ചറൽ ഓയിൽ പ്രയോഗിക്കുക.

5. അകാരിസൈഡുകൾ ഉപയോഗിക്കുക: ബാധ ഗുരുതരമായാൽ, അബാമെക്‌ടിൻ, ബിഫെനാസേറ്റ്, എതോക്സാസോൾ തുടങ്ങിയ അകാരിസൈഡുകൾ (മൈറ്റിസൈഡുകൾ) ഉപയോഗിക്കുക. ലേബൽ നിർദ്ദേശങ്ങൾ കൃത്യമായി പാലിക്കണം.

6. ഗുരുതരമായി ബാധിതമായ ചെടികൾ നീക്കം ചെയ്യുക: ഗുരുതരമായ ബാധയുണ്ടെങ്കിൽ, മറ്റ് ചെടികളിലേക്കുള്ള വ്യാപനം തടയുന്നതിന് ബാധിതമായ ചെടികൾ നീക്കം ചെയ്ത് നശിപ്പിക്കേണ്ടതുണ്ട്.

7. ചെടികളുടെ ആരോഗ്യം മെച്ചപ്പെടുത്തുക: യോജിച്ച വളപ്രയോഗം, ജലസേചനം, പൊതുവെ ചെടികളുടെ ആരോഗ്യം എന്നിവ പരിപാലിക്കുക. മെനഞ്ഞ ചെടികൾ സ്പെെഡർ മൈറ്റ് ബാധയ്ക്ക് വഴിവയ്ക്കും.

8. വിളചക്രഘട്ടനം പാലിക്കുക: സോലാനേഷ്യൻ കുടുംബത്തിൽപ്പെടാത്ത വിളകളുമായി തക്കാളി വിള ചക്രഘട്ടനം നടത്തുക. ഇത് കീടബാധ ചക്രം തകർക്കാനും സ്പെെഡർ മൈറ്റ് പ്രചാരം തടയാനും സഹായിക്കും.
''',
  '''Septoria Leaf Spot''': '''
1. പ്രതിരോധശേഷിയുള്ള ഇനങ്ങൾ തിരഞ്ഞെടുക്കുക: സെപ്റ്റോറിയ ലീഫ് സ്പോട്ട് രോഗത്തോട് പ്രതിരോധശേഷിയോ ടോളറൻസോ ഉള്ള തക്കാളി ഇനങ്ങൾ നടുക.

2. വിളചക്രഘട്ടനം പാലിക്കുക: 2-3 വർഷത്തിലൊരിക്കൽ സോലാനേഷ്യൻ കുടുംബത്തിൽപ്പെടാത്ത വിളകളുമായി തക്കാളി വിള ചക്രഘട്ടനം നടത്തുക. ഇത് മണ്ണിലെ രോഗാണുക്കളുടെ സാന്ദ്രത കുറയ്ക്കും.

3. രോഗബാധിതമായ ചെടിയവശിഷ്ടങ്ങൾ നീക്കം ചെയ്യുക: രോഗബാധിതമായ ഇലകൾ, തണ്ടുകൾ, ചെടിയവശിഷ്ടങ്ങൾ എന്നിവ ശ്രദ്ധാപൂർവ്വം നീക്കം ചെയ്ത് നശിപ്പിക്കുക.

4. വായുസഞ്ചാരം മെച്ചപ്പെടുത്തുക: ചെടികളുടെ താഴെവശങ്ങൾ വൃത്തിയാക്കുകയും കമ്പുകൾ വച്ച് പിന്തുണ നൽകുകയും ചെയ്യുക. ഇത് വായുസഞ്ചാരവും ആർദ്രതാനിയന്ത്രണവും സാധ്യമാക്കും.

5. മുകളിലൂടെയുള്ള ജലസേചനം ഒഴിവാക്കുക: ചെടികളുടെ അടിവശത്ത് ജലസേചനം നൽകുക. ഇത് മണ്ണിലെ സ്പോറുകൾ ജലത്തിന്റെ ചാട്ടംമൂലം ഇലകളിലേക്ക് എത്തുന്നത് തടയും.

6. ഫംഗസൈഡുകൾ പ്രയോഗിക്കുക: ക്ലോറോഥലോണിൽ, മാൻകോസെബ്, കോപ്പർ ലായനികൾ തുടങ്ങിയ ശുപാർശ ചെയ്യപ്പെട്ട ഫംഗസൈഡുകൾ പ്രതിരോധാത്മകമായി ഉപയോഗിക്കുക.

7. പോഷകമൂല്യങ്ങൾ സമതുലിതമാക്കുക: സമതുലിതമായ വളപ്രയോഗം ഉറപ്പുവരുത്തുക, പോഷകക്കുറവ് ചെടികളെ രോഗബാധയ്ക്കു വഴിവയ്ക്കും.

8. മള്ച്ചിംഗ് നടപ്പിലാക്കുക: ചെടികളുടെ ചുറ്റും കനത്ത സാംപ്ലുമള്ച്ചിംഗ് നൽകുക. ഇത് മണ്ണിലെ സ്പോറുകൾ ജലത്തിന്റെ ചാട്ടംമൂലം ഇലകളിലേക്ക് എത്തുന്നത് തടയും.
''',
  '''Leaf Mold''':
      '''1. പ്രതിരോധശേഷിയുള്ള ഇനങ്ങൾ തിരഞ്ഞെടുക്കുക: ലീഫ് മോൾഡ് രോഗത്തോട് പ്രതിരോധശേഷിയുള്ള തക്കാളി ഇനങ്ങൾ നടുക. ഇത് രോഗബാധ കുറയ്ക്കാൻ സഹായിക്കും.

2. വായുസഞ്ചാരം മെച്ചപ്പെടുത്തുക: തക്കാളിച്ചെടികൾക്കിടയിൽ മതിയായ അകലം പാലിക്കുകയും ചെടികളുടെ താഴെവശങ്ങൾ വൃത്തിയാക്കുകയും ചെയ്യുക. ഇത് വായുസഞ്ചാരം സുഗമമാക്കി അമിതാർദ്രത ലഘൂകരിക്കും.

3. മള്ച്ചിംഗ് നടപ്പിലാക്കുക: തക്കാളിച്ചെടികളുടെ ചുറ്റും മള്ച്ചിംഗ് നല്കുക. ഇത് മണ്ണിൽ നിന്നുള്ള ഫംഗസ് സ്പോർ ചാടിക്കയറുന്നത് തടയുന്നതിനും മണ്ണിലെ ആർദ്രത നിലനിർത്താനും സഹായിക്കും.

4. ജലസംരക്ഷണം നടപ്പിലാക്കുക: രാവിലെയോ വൈകുന്നേരമോ മാത്രം ജലസേചനം നടത്തുക. മുകളിലൂടെയുള്ള ജലസേചനം ഒഴിവാക്കുക. ഇത് ഇലകളിലെ അമിതാർദ്രത ഒഴിവാക്കും.

5. രോഗബാധിതമായ ഇലകൾ നീക്കം ചെയ്യുക: ലീഫ് മോൾഡ് ലക്ഷണങ്ങളുള്ള ഇലകൾ ശ്രദ്ധാപൂർവ്വം നീക്കം ചെയ്ത് നശിപ്പിക്കുക. ഇത് രോഗവ്യാപനം തടയുന്നതിന് സഹായകരമാകും.

6. ഫംഗസൈഡുകൾ പ്രയോഗിക്കുക: കോപ്പർ ഓക്സിക്ലോറൈഡ്, ക്ലോറോഥലോണിൽ തുടങ്ങിയ ഫംഗസൈഡുകളുടെ ഉപയോഗം രോഗബാധ കുറയ്ക്കാൻ സഹായിക്കും. നിർദ്ദേശങ്ങൾ കൃത്യമായി പാലിക്കണം.

7. വിളചക്രഘട്ടനം പാലിക്കുക: ലീഫ് മോൾഡ് രോഗബാധയുണ്ടായ സ്ഥലത്ത് കുറഞ്ഞത് രണ്ടുവർഷം തക്കാളി നടുന്നത് ഒഴിവാക്കുക. ഇത് രോഗചക്രം തകർക്കാൻ സഹായിക്കും.

8. ശുചിത്വം പാലിക്കുക: രോഗബാധിതമായ ചെടികളുമായി ബന്ധപ്പെട്ട ഉപകരണങ്ങൾ, തണ്ടുകൾ തുടങ്ങിയവ വൃത്തിയാക്കുക. തോട്ടത്തിന്റെ ശുചിത്വം പാലിക്കുക.''',
  '''Tomato healthy''': '''''',
  '''Tomato Mosaic Virus''':
      ''' പ്രതിരോധശേഷിയുള്ള ഇനങ്ങൾ തിരഞ്ഞെടുക്കുക: മോസായിക് വൈറസ് രോഗത്തോട് പ്രതിരോധമുള്ളതും സഹിഷ്ണുതയുള്ളതുമായ തക്കാളി ഇനങ്ങൾ തിരഞ്ഞെടുക്കുക. ഇത് രോഗബാധാ സാധ്യത കുറയ്ക്കുകയും രോഗവ്യാപനം പരിമിതപ്പെടുത്തുകയും ചെയ്യും.

2. രോഗബാധിതമായ ചെടികൾ നീക്കം ചെയ്യുക: തക്കാളിച്ചെടികളിൽ മോസായിക് പാറ്റേൺ, വളർച്ചാകുഴപ്പം, ഇലനിർമ്മിതിയിലുള്ള വൈകല്യം തുടങ്ങിയ മോസായിക് വൈറസ് രോഗലക്ഷണങ്ങൾ കാണുന്ന ചെടികൾ കണ്ടെത്തി നീക്കം ചെയ്യുക. ഈ ചെടികൾ നശിപ്പിച്ച് വൈറസ് വ്യാപനം തടയുക.

3. കളനാശിനി ഉപയോഗിക്കുക: ചില കളകൾ മോസായിക് വൈറസിന്റെ വാഹകരായി പ്രവർത്തിക്കുന്നു. തക്കാളിതോട്ടത്തിനകത്തും ചുറ്റുമുള്ളും കളകൾ നീക്കം ചെയ്ത് വൈറസിന്റെ സാധ്യതകൾ ഇല്ലാതാക്കുക.

4. നല്ല ശുചിത്വം പാലിക്കുക: രോഗബാധിതമായ ചെടികളുമായി ബന്ധപ്പെട്ട ഗാർഡനിംഗ് ഉപകരണങ്ങൾ, തണ്ടുകൾ തുടങ്ങിയവ വൃത്തിയാക്കുക. വൈറസ് മലിനമായ ഉപകരണങ്ങൾ വഴി പകരാം.

5. വാഹക കീടങ്ങളെ നിയന്ത്രിക്കുക: മോസായിക് വൈറസ് വാഹക കീടങ്ങളായ എലി, വെളുത്തുള്ളി, തൃപ്പ് തുടങ്ങിയവയുടെ എണ്ണം കുറയ്ക്കുന്ന കീടനിയന്ത്രണ നടപടികൾ സ്വീകരിക്കുക. 

6. പുകവലി ഒഴിവാക്കുക: പുകയില പ്രിയരാണെങ്കിൽ പുകവലിക്കുശേഷം തക്കാളിച്ചെടികൾ സമീപിക്കുന്നത് ഒഴിവാക്കുക. വൈറസ് കരങ്ങളിലൂടെ പകരാം.

7. വിളചക്രഘട്ടനം പാലിക്കുക: കുറഞ്ഞത് രണ്ട് മുതൽ മൂന്ന് വർഷം വരെ തക്കാളിയോ മറ്റ് സോലാനേസിയൻ വിളകളോ (മുളക്, വാഴക്ക തുടങ്ങിയവ) ഒരേ സ്ഥലത്ത് നടുന്നത് ഒഴിവാക്കുക. ഇത് മണ്ണിൽ വൈറസ് കൂടിക്കൂടുന്നത് തടയും.

8. വിളയവശിഷ്ടങ്ങൾ നശിപ്പിക്കുക: വിളവെടുപ്പിന് ശേഷം തക്കാളിച്ചെടികളുടെ അവശിഷ്ടങ്ങൾ നീക്കം ചെയ്ത് നശിപ്പിക്കുക. ഇത് അടുത്ത കൃഷിക്കാലത്ത് വൈറസ് ഉറവിടങ്ങൾ ഇല്ലാതാക്കും.''',
  '''Tomato Yellow Leaf Curl Virus''':
      '''ചുവടെ തക്കാളിച്ചെടികളിലെ യെല്ലോ ലീഫ് കർൾ വൈറസ് രോഗത്തിനുള്ള ചികിത്സാ നിർദ്ദേശങ്ങൾ മലയാളത്തിൽ കൊടുത്തിരിക്കുന്നു:

1. പ്രതിരോധശേഷിയുള്ള ഇനങ്ങൾ തിരഞ്ഞെടുക്കുക: യെല്ലോ ലീഫ് കർൾ വൈറസ് രോഗത്തോട് പ്രതിരോധശേഷിയുള്ള തക്കാളി ഇനങ്ങൾ തിരഞ്ഞെടുക്കുക. പുതിയ ഹൈബ്രിഡ് ഇനങ്ങളിൽ പലതും ഈ വൈറസിനെതിരേ പ്രതിരോധശേഷിയുള്ളവയാണ്.

2. വെളുത്തുള്ളികളെ നിയന്ത്രിക്കുക: വെളുത്തുള്ളികൾ മുഖേനയാണ് ഈ വൈറസ് പ്രധാനമായും പകരുന്നത്. മഞ്ഞ നിറത്തിലുള്ള ഫൈബർ ബോർഡുകൾ, കീടനാശിനി സോപ്പുകൾ/ഓയിലുകൾ, പോൻചുണ്ടുകൾ പോലുള്ള സ്വാഭാവിക ശത്രുക്കളെ ഉപയോഗിച്ച് വെളുത്തുള്ളികളെ നിയന്ത്രിക്കുക.

3. രോഗബാധിതമായ ചെടികൾ നീക്കം ചെയ്യുക: മഞ്ഞ നിറത്തിലുള്ള ഇലകൾ, ഇലകൾ ചുരുണ്ടുപോകൽ, വളർച്ചാകുഴപ്പം, പൂക്കുന്നതിലുള്ള പ്രശ്നങ്ങൾ തുടങ്ങിയ ലക്ഷണങ്ങൾ കാണിക്കുന്ന തക്കാളിച്ചെടികൾ വേരോടെ നീക്കം ചെയ്ത് നശിപ്പിക്കുക.

4. ശുചിത്വം പാലിക്കുക: രോഗബാധിതമായ ചെടികളുമായി ബന്ധപ്പെട്ട ഉപകരണങ്ങളും തണ്ടുകളും വൃത്തിയാക്കുക. തോട്ടത്തിന്റെ ശുചിത്വം പാലിക്കുക.

5. വിളചക്രഘട്ടനം പാലിക്കുക: വൈറസ് രോഗബാധയുണ്ടായിരുന്ന സ്ഥലത്ത് കുറഞ്ഞത് രണ്ട് മുതൽ മൂന്ന് വർഷം വരെ തക്കാളിയോ മറ്റ് ബാധിതമാകാവുന്ന വിളകളോ നടുന്നത് ഒഴിവാക്കുക.

6. പ്രതിഫലന മൾച്ചുകൾ ഉപയോഗിക്കുക: അലുമിനിയം ഫോയിലോ പ്രതിഫലന മള്ച്ചുകളോ ഉപയോഗിക്കുന്നത് വെളുത്തുള്ളികൾ ചെടികളിൽ വന്നിരിക്കുന്നത് തടയാൻ സഹായിക്കും.

7. കളകൾ നീക്കം ചെയ്യുക: തക്കാളിതോട്ടത്തിനകത്തും ചുറ്റുപാടുമുള്ള കളകൾ നീക്കം ചെയ്യുക, കാരണം ചില കളകൾ വൈറസിനും വെളുത്തുള്ളികൾക്കും വാഹകരായേക്കാം.

8. നടീൽ സമയം ക്രമീകരിക്കുക: വെളുത്തുള്ളികളുടെ സാന്ദ്രത കുറവായിരിക്കുന്ന സമയത്ത് തക്കാളി നടുന്നത് വൈറസ് ബാധാ സാധ്യത കുറയ്ക്കും.

9. ഫിസിക്കൽ തടസ്സങ്ങൾ സൃഷ്ടിക്കുക: തക്കാളിച്ചെടികൾക്ക് മുകളിൽ ഫൈബർ ഷീറ്റുകളോ നെറ്റിംഗുകളോ സ്ഥാപിച്ച് വെളുത്തുള്ളികളെ ചെടികളിൽ നിന്ന് അകറ്റി നിർത്താം.
''',
  '''Target Spot''':
      '''1. വെട്ടിത്തുരത്തൽ: ലക്ഷ്യസ്ഥാന രോഗലക്ഷണങ്ങളുള്ള ഇലകൾ പോലുള്ള ബാധിതമായ സസ്യഭാഗങ്ങൾ നീക്കം ചെയ്യുകയും നശിപ്പിക്കുകയും ചെയ്യുക. ഇത് രോഗവ്യാപനം സസ്യത്തിനകത്തും അതുവഴി അയൽസസ്യങ്ങളിലേക്കും കുറയ്ക്കാൻ സഹായിക്കും.

2. ശുചിത്വം: തക്കാളിച്ചെടികളുടെ ചുറ്റുമുള്ള വീണുകിടക്കുന്ന ഇലകളും അവശിഷ്ടങ്ങളും നീക്കം ചെയ്ത് നല്ല തോട്ടവിത്ത് പാലിക്കുക. ഇത് ഫംഗസ് സ്പോറുകളുടെ കൂട്ടക്കൂടി വരവ് കുറയ്ക്കുകയും രോഗബാധാ സാധ്യത കുറയ്ക്കുകയും ചെയ്യും.

3. വിള ചക്രഘട്ടനം: കഴിഞ്ഞ വർഷങ്ങളിൽ ലക്ഷ്യസ്ഥാന രോഗം കാണപ്പെട്ട പ്രദേശത്ത് തക്കാളി അല്ലെങ്കിൽ മറ്റ് ബാധിതമാകാവുന്ന വിളകൾ നടുന്നത് ഒഴിവാക്കുക. രോഗചക്രം തകർക്കാൻ വിളകളെ വ്യത്യസ്ത സ്ഥലങ്ങളിലേക്ക് മാറ്റുക.

4. ജലസംരക്ഷണം: മുകളിൽ നിന്നുള്ള ജലസേചനം ഒഴിവാക്കുകയും സസ്യങ്ങളുടെ അടിവശത്ത് മാത്രം ജലസേചനം നടത്തി ഇലകൾ ഉണങ്ങാതിരിക്കുക. ഇലകളിലെ അമിതാർദ്രത ഫംഗസ് വളർച്ചയ്ക്ക് അനുകൂലമാകും.

5. വസ്ത്രാവരണം: തക്കാളിച്ചെടികളുടെ ചുറ്റുമുള്ള സാന്ദ്രമായ വസ്ത്രാവരണം മണ്ണിലെ ആർദ്രതാനിലയിൽ സഹായിക്കുകയും മണ്ണ് ചാടിക്കൊണ്ട് ഫംഗസ് സ്പോറുകൾ പരന്നുപിടിക്കുന്നത് തടയുകയും ചെയ്യും.

7. പ്രതിരോധശേഷിയുള്ള ഇനങ്ങൾ: ലഭ്യമെങ്കിൽ, ലക്ഷ്യസ്ഥാന രോഗത്തിനെതിരെ പ്രതിരോധശേഷിയുള്ളതെന്ന് അറിയപ്പെടുന്ന തക്കാളി ഇനങ്ങൾ നടുന്നത് പരിഗണിക്കുക.''',
  '''Tobacco Mosaic Virus''':
      '''Tobacco mosaic virus is a viral disease that affects a wide range of plants, including tomatoes. It causes mottled or streaked patterns of light and dark green on leaves, stunted growth, and reduced fruit quality and yield. It is highly contagious and can be transmitted through contaminated hands, tools, and sap.'''
};

String getTranslatedName(String englishName, bool isEnglish) {
  if (isEnglish) {
    return englishName;
  } else {
    return malayalamTranslations[englishName] ?? englishName;
  }
}

class IdentifyScreen extends StatefulWidget {
  const IdentifyScreen({Key? key}) : super(key: key);

  @override
  _IdentifyScreenState createState() => _IdentifyScreenState();
}

class _IdentifyScreenState extends State<IdentifyScreen> {
  bool isEnglish = true;
  Future<void> _checkLanguagePreference() async {
    setState(() {
      LanguagePreferences.getLanguagePreference().then((value) {
        setState(() {
          isEnglish = value;
        });
      });
    });
  }

  Future<void> _toggleLanguage() async {
    setState(() {
      isEnglish = !isEnglish;
    });

    LanguagePreferences.setLanguagePreference(isEnglish);
  }

  bool _isLoading = false;
  Map<String, dynamic>? _response;

  @override
  void initState() {
    super.initState();
    _checkLanguagePreference();
  }

  Future<void> _selectImage(BuildContext context, bool option) async {
    setState(() {
      _isLoading = true;
    });

    final ImagePicker picker = ImagePicker();
    final XFile? image = await picker.pickImage(
        source: option ? ImageSource.gallery : ImageSource.camera);
    if (image != null) {
      var url = Uri.http('$serverIp:5000', '/upload_image');

      var request = http.MultipartRequest('POST', url);
      var takenPicture =
          await http.MultipartFile.fromPath('''image''', image.path);
      request.files.add(takenPicture);
      var response = await request.send();
      if (response.statusCode == 200) {
        print('Image uploaded!');
        var responseData = await response.stream.bytesToString();
        print(responseData);

        _response = jsonDecode(responseData);

        String identifiedDisease = _response!['prediction'][0];
        String identifiedDisease1 = _response!['prediction'][1];
        String identifiedDisease2 = _response!['prediction'][2];
        if (identifiedDisease != 'Tomato healthy') {
          Disease? disease = diseases.firstWhere(
            (disease) => disease.name == identifiedDisease,
          );
          if (disease != null) {
            showDialog(
              context: context,
              builder: (BuildContext context) {
                return AlertDialog(
                  title: Text(
                      'Prediction Result: ${getTranslatedName(identifiedDisease, isEnglish)}'),
                  content: SingleChildScrollView(
                    child: Column(
                      mainAxisSize: MainAxisSize.min,
                      crossAxisAlignment: CrossAxisAlignment.stretch,
                      children: [
                        Text(
                            'Prediction 2nd: ${getTranslatedName(identifiedDisease1, isEnglish)}'),
                        Text(
                            'Prediction 3rd: ${getTranslatedName(identifiedDisease2, isEnglish)}'),
                        SizedBox(
                          height: 20,
                        ),
                        if (isEnglish)
                          for (var treatmentStep in disease.treatment)
                            Padding(
                              padding: const EdgeInsets.only(bottom: 8.0),
                              child: Text(
                                treatmentStep,
                                textAlign: TextAlign.center,
                              ),
                            ),
                        if (!isEnglish)
                          Padding(
                            padding: const EdgeInsets.only(bottom: 8.0),
                            child: Text(
                              diseaseDescriptions[identifiedDisease] ??
                                  'Description not available',
                              textAlign: TextAlign.center,
                            ),
                          ),
                      ],
                    ),
                  ),
                  actions: <Widget>[
                    TextButton(
                      onPressed: () {
                        Navigator.of(context).pop();
                      },
                      child: const Text('OK'),
                    ),
                  ],
                );
              },
            );
          } else {
            print('Disease not found in the list');
          }
        }
      } else {
        const snackBar = SnackBar(
          content: Text('The tomato is healthy'),
        );
        ScaffoldMessenger.of(context).showSnackBar(snackBar);
      }

      setState(() {
        _isLoading = false;
      });
    }
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        centerTitle: true,
        title: isEnglish ? Text('Agronomi Xpert') : Text('അഗ്രോണോമി'),
        leading: isEnglish
            ? IconButton(
                onPressed: () {
                  _toggleLanguage();
                },
                icon: Icon(Icons.translate_rounded))
            : null,
        actions: [
          !isEnglish
              ? IconButton(
                  onPressed: () {
                    _toggleLanguage();
                  },
                  icon: Icon(Icons.translate_rounded))
              : SizedBox()
        ],
      ),
      body: Center(
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: <Widget>[
            Image.asset(
              'assets/images/icon.png',
              width: 150,
              height: 150,
            ),
            const SizedBox(height: 20),
            isEnglish
                ? Text(
                    'Welcome to Agronomi Xpert',
                    style: TextStyle(fontSize: 24, fontWeight: FontWeight.bold),
                  )
                : Center(
                    child: Text(
                      'സ്വാഗതം',
                      style:
                          TextStyle(fontSize: 24, fontWeight: FontWeight.bold),
                    ),
                  ),
            const SizedBox(height: 20),
            Padding(
              padding: const EdgeInsets.all(8.0),
              child: isEnglish
                  ? Text(
                      'Identify different types of tomato diseases with ease using Machine Learning technology.',
                      textAlign: TextAlign.center,
                      style: TextStyle(fontSize: 16),
                    )
                  : Text(
                      'മെഷീൻ ലേർണിംഗ് ടെക്നോളജി ഉപയോഗിച്ച് എളുപ്പത്തിൽ മട്ടിലാക്കാൻ വിവിധ തരം തക്കാളി രോഗങ്ങൾ തിരഞ്ഞെടുക്കുക.',
                      textAlign: TextAlign.center,
                      style: TextStyle(fontSize: 16),
                    ),
            ),
            const SizedBox(height: 40),
            const SizedBox(height: 40),
            Row(
              mainAxisAlignment: MainAxisAlignment.spaceEvenly,
              children: [
                ElevatedButton.icon(
                  onPressed: () => _selectImage(context, false),
                  icon: const Icon(Icons.photo_camera),
                  label: _isLoading
                      ? const CircularProgressIndicator()
                      : isEnglish
                          ? Text('Camera')
                          : Text('ക്യാമറ'),
                ),
                ElevatedButton.icon(
                  onPressed: () => _selectImage(context, true),
                  icon: const Icon(Icons.photo_camera),
                  label: _isLoading
                      ? const CircularProgressIndicator()
                      : isEnglish
                          ? Text('Gallery')
                          : Text('ഗാലറി'),
                ),
              ],
            ),
          ],
        ),
      ),
    );
  }
}
